<div class="mt-6">
    <h2 class="header header-2">Customer Reviews</h2>

    <div class="mt-6 grid grid-cols-1 gap-1 md:grid-cols-2">
        @for (r of reviews(); track $index; let i = $index; let isFirst = $first; let isLast = $last) {
            <div [class]="getReviewClassName(i, isFirst, isLast)">
                <span>
                    <span class="text-base font-medium">{{ r.name }}</span>
                    <br />
                    <span>{{ r.grade }}</span>
                </span>

                <span class="text-base font-medium">{{ r.rating }}</span>
            </div>
        }
    </div>

    @for (c of comments(); track $index) {
        <div class="mt-6">
            <div class="flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
                <span class="flex items-center gap-2">
                    <span class="inline-flex size-10 items-center justify-center rounded-full bg-black text-white">
                        {{ c.name.charAt(0).toUpperCase() }}
                    </span>
                    <span>{{ c.name }}</span>
                </span>
                <span>{{ c.date }}</span>
            </div>

            <div class="mt-3 flex flex-col gap-2 md:flex-row md:items-center">
                <app-rate-star [rate]="c.rating" [count]="c.reviewCount" />
                <span class="text-base font-medium">{{ c.title }}</span>
            </div>

            <p class="mt-4 text-ellipsis">
                @if (c.comment.length > 100) {
                    {{ c.comment.slice(0, 100) }}...
                    <br />
                    <app-button severity="outline" className="text-primary-100 mt-2">Read more</app-button>
                } @else {
                    {{ c.comment }}
                }
            </p>

            <div class="mt-6 flex gap-4">
                <app-thumbnail className="h-auto w-32" imageUrl="assets/images/home/reviews/image.png" />
                <app-thumbnail className="h-auto w-32" imageUrl="assets/images/home/reviews/image-1.png" />
                <app-thumbnail className="h-auto w-32" imageUrl="assets/images/home/reviews/image-2.png" />
            </div>

            <div class="mt-4 flex gap-4">
                <app-button severity="outline">
                    <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M0 16H3.27273V6.4H0V16ZM18 7.2C18 6.32 17.2636 5.6 16.3636 5.6H11.2009L11.9782 1.944L12.0027 1.688C12.0027 1.36 11.8636 1.056 11.6427 0.84L10.7755 0L5.39182 5.272C5.08909 5.56 4.90909 5.96 4.90909 6.4V14.4C4.90909 15.28 5.64545 16 6.54545 16H13.9091C14.5882 16 15.1691 15.6 15.4145 15.024L17.8855 9.384C17.9591 9.2 18 9.008 18 8.8V7.2Z"
                            fill="black" />
                    </svg>
                    Helpful
                </app-button>
                <app-button severity="outline">
                    <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M11.4545 0H4.09091C3.41182 0 2.83091 0.4 2.58545 0.976L0.114545 6.616C0.0409091 6.8 0 6.992 0 7.2V8.8C0 9.68 0.736364 10.4 1.63636 10.4H6.79909L6.02182 14.056L5.99727 14.312C5.99727 14.64 6.13636 14.944 6.35727 15.16L7.22455 16L12.6164 10.728C12.9109 10.44 13.0909 10.04 13.0909 9.6V1.6C13.0909 0.72 12.3545 0 11.4545 0ZM14.7273 0V9.6H18V0H14.7273Z"
                            fill="black" />
                    </svg>
                    Not helpful
                </app-button>
            </div>
        </div>
    }
</div>

<div class="mt-6">
    <h2 class="header header-2">Leave a Reply</h2>

    <p class="mt-8">Your email address will not be published. Required fields are marked *</p>

    <div class="mt-8 grid grid-cols-1 md:grid-cols-2 md:gap-y-4 lg:grid-cols-3">
        @for (c of categories(); track $index) {
            <app-button
                (click)="category.set(c)"
                className="rounded-xl"
                [severity]="category() === c ? 'primary' : 'default'">
                {{ c }}
            </app-button>
        }
    </div>

    <form (ngSubmit)="postComment()" [formGroup]="form" class="mt-8 flex flex-col gap-4">
        <div class="grid grid-cols-2 gap-8">
            <div>
                <app-input placeholder="Name*" formControlName="name" />
                @if (
                    form.controls.name.invalid &&
                    (form.controls.name.dirty || form.controls.name.touched) &&
                    form.controls.name.hasError('required')
                ) {
                    <span class="text-sm text-warning">Name is required</span>
                }
            </div>
            <div>
                <app-input placeholder="Email*" formControlName="email" />
                @if (form.controls.email.invalid && (form.controls.email.dirty || form.controls.email.touched)) {
                    @if (form.controls.email.hasError('required')) {
                        <span class="text-sm text-warning">Name is required</span>
                    }
                    @if (form.controls.email.hasError('email')) {
                        <span class="text-sm text-warning">Invalid email</span>
                    }
                }
            </div>
        </div>
        <div>
            <app-input placeholder="Title*" formControlName="title" />
            @if (
                form.controls.title.invalid &&
                (form.controls.title.dirty || form.controls.title.touched) &&
                form.controls.title.hasError('required')
            ) {
                <span class="text-sm text-warning">Name is required</span>
            }
        </div>
        <div>
            <textarea placeholder="Comment*" formControlName="comment" class="form-input h-40 w-full p-4"></textarea>
            @if (
                form.controls.comment.invalid &&
                (form.controls.comment.dirty || form.controls.comment.touched) &&
                form.controls.comment.hasError('required')
            ) {
                <span class="text-sm text-warning">Name is required</span>
            }
        </div>

        <div class="flex flex-col gap-2">
            <div class="flex gap-2">
                @for (r of [1, 2, 3, 4, 5]; track r) {
                    <app-button severity="outline" (click)="form.patchValue({ rate: r })" className="p-0">
                        @if (r <= (form.controls.rate.value ?? -1)) {
                            <svg
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M14.916 9.6L12 0L9.084 9.6H0L7.416 14.892L4.596 24L12 18.372L19.416 24L16.596 14.892L24 9.6H14.916Z"
                                    fill="currentColor" />
                            </svg>
                        } @else {
                            <svg
                                width="24"
                                height="23"
                                viewBox="0 0 24 23"
                                fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M24 8.76421L15.372 8.01368L12 0L8.628 8.02579L0 8.76421L6.552 14.49L4.584 23L12 18.4847L19.416 23L17.46 14.49L24 8.76421ZM12 16.2211L7.488 18.9689L8.688 13.7879L4.704 10.3016L9.96 9.84158L12 4.96316L14.052 9.85368L19.308 10.3137L15.324 13.8L16.524 18.9811L12 16.2211Z"
                                    fill="currentColor" />
                            </svg>
                        }
                    </app-button>
                }
            </div>
            @if (form.controls.rate.value === -1 && (form.controls.rate.dirty || form.controls.rate.touched)) {
                <span class="text-sm text-warning">Rate is required</span>
            }
        </div>

        <app-button severity="primary" type="submit" className="mt-8">Post Comment </app-button>
    </form>
</div>
